# Set ctrl space as prefix
set -g prefix C-Space
bind C-Space send-prefix
bind C-b send-prefix

##### History, timing ##########################################################
set -g history-limit 100000
set -g display-time 5000
set -g escape-time 0          # instant key handling for Vim/TUI apps
set -g focus-events on

##### Indexing, naming #########################################################
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g allow-rename off       # apps cannot rename windows

##### Mouse ####################################################################
set -g mouse on

##### Keys: vi everywhere ######################################################
set -g status-keys vi
setw -g mode-keys vi

# Split keep cwd
bind "|" split-window -h -c "#{pane_current_path}"
bind "-" split-window -v -c "#{pane_current_path}"

# Vim-aware pane navigation (works for vim/nvim and copy-mode)
bind -n C-h if-shell -F '#{?pane_in_mode,1,#{m:n?vim,#{pane_current_command}}}' 'send-keys C-h' 'select-pane -L'
bind -n C-j if-shell -F '#{?pane_in_mode,1,#{m:n?vim,#{pane_current_command}}}' 'send-keys C-j' 'select-pane -D'
bind -n C-k if-shell -F '#{?pane_in_mode,1,#{m:n?vim,#{pane_current_command}}}' 'send-keys C-k' 'select-pane -U'
bind -n C-l if-shell -F '#{?pane_in_mode,1,#{m:n?vim,#{pane_current_command}}}' 'send-keys C-l' 'select-pane -R'

# bind -n C-h run "(tmux display-message -p '#{pane_current_command} #{pane_title}' | grep -iq vi && tmux send-keys C-h) || tmux select-pane -L"
# bind -n C-j run "(tmux display-message -p '#{pane_current_command} #{pane_title}' | grep -iq vi && tmux send-keys C-j) || tmux select-pane -D"
# bind -n C-k run "(tmux display-message -p '#{pane_current_command} #{pane_title}' | grep -iq vi && tmux send-keys C-k) || tmux select-pane -U"
# bind -n C-l run "(tmux display-message -p '#{pane_current_command} #{pane_title}' | grep -iq vi && tmux send-keys C-l) || tmux select-pane -R"

# Fast resizing with Alt+arrows
bind -n M-h resize-pane -L 5
bind -n M-j resize-pane -D 5
bind -n M-k resize-pane -U 5
bind -n M-l resize-pane -R 5

##### Copy-mode yanks to system clipboard (Wayland/X fallback) #################
# Requires wl-copy or xclip installed.
bind -T copy-mode-vi y send -X copy-pipe-and-cancel 'sh -c "command -v wl-copy >/dev/null && wl-copy || xclip -i -sel clip"'

##### Status bar ###############################################################
set -g status on
set -g status-interval 5
set -g status-style bg=black,fg=white

# Pane borders
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour46

# Left/Right
set -g status-left-length 40
set -g status-right-length 120
set -g status-left  '#[fg=green][#[fg=cyan]#S#[fg=green]] '
set -g status-right '#[fg=green][#[fg=cyan]%Y-%m-%d %H:%M#[fg=green]]'

# Windows
setw -g window-status-style fg=grey,dim
setw -g window-status-current-style fg=white,bold
setw -g window-status-format '#I:#W'
setw -g window-status-current-format '#[fg=green][#I:#W]'

setw -g aggressive-resize on

##### Titles ###################################################################
set -g set-titles on
set -g set-titles-string '#S|#W'
setw -g automatic-rename on

##### Truecolor that doesn’t shift when opening Neovim #########################
# Use tmux-256color and advertise RGB to the underlying terminal.
# tmux ≥3.2: use RGB. For older tmux, replace RGB with Tc.
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",*:RGB"

# If your system lacks tmux-256color terminfo, install it once:
# tic -x -o ~/.terminfo /usr/share/terminfo/t/tmux-256color

##### Plugins (optional TPM) ###################################################
# run-shell '~/.tmux/plugins/tpm/tpm'
